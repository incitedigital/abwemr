/*
 Ajax Autocomplete
 Version: 1.2.0
 (c) 2011 DMXzone.com
 @build 25-08-2011 10:30:12
*/
(function(c){c.fn.extend({autocomplete:function(b,a){var f="string"==typeof b,i="GoogleAjax"==b,a=c.extend({},c.Autocompleter.defaults,{url:f?i?"http://maps.googleapis.com/maps/api/geocode/json?sensor=false":b:null,data:f?null:b,staticData:f?/(.txt|.xml)$/.test(b):!0,delay:f?c.Autocompleter.defaults.delay:10,isGoogleAjax:i},a);a.limitName="";a.limitCode="";if(a.isGoogleAjax&&(a.searchAll=!1,a.matchSubset=!1,(f=a.gRegion?a.gRegion.split("|"):[])&&1<f.length)){if(f[0])a.limitCode=f[0];if(f[1])a.limitName=
f[1]}return this.each(function(){new c.Autocompleter(this,a)})},result:function(b){return this.bind("result",b)},search:function(){return this.trigger("search")}});c.Autocompleter=function(b,a){var f;function i(b,s,A){var h=p.selected();if(!h)return!1;var e=h.result;u=e;if(a.multiple){var k=r(l.val());1<k.length&&(e=k.slice(0,k.length-1).join(a.multipleSeparator)+a.multipleSeparator+e);e+=a.multipleSeparator}l.val(e);a.hiddenIdField&&""!=a.hiddenIdField&&(e=c('input[name="'+a.hiddenIdField+'"]'))&&
e.val(h.idVal);if(a.gStreetField&&""!=a.gStreetField&&(k=c('input[name="'+a.gStreetField+'"]')))(e=g(h.obj,"street_address"))||(e=g(h.obj,"route")),e&&e.short_name&&e.long_name?k.val(a.gStreetFieldShort?e.short_name:e.long_name):k.val("");if(a.gStreetNumberField&&""!=a.gStreetNumberField&&(k=c('input[name="'+a.gStreetNumberField+'"]')))(e=g(h.obj,"street_number"))&&e.long_name?k.val(e.long_name):k.val("");if(a.gCityField&&""!=a.gCityField&&(k=c('input[name="'+a.gCityField+'"]')))(e=g(h.obj,"locality"))&&
e.short_name&&e.long_name?k.val(a.gCityFieldShort?e.short_name:e.long_name):k.val("");if(a.gCountryField&&""!=a.gCountryField&&(k=c('input[name="'+a.gCountryField+'"]')))(e=g(h.obj,"country"))&&e.short_name&&e.long_name?k.val(a.gCountryFieldShort?e.short_name:e.long_name):k.val("");if(a.gStateField&&""!=a.gStateField&&(k=c('input[name="'+a.gStateField+'"]')))(e=g(h.obj,"administrative_area_level_1"))&&e.short_name&&e.long_name?k.val(a.gStateFieldShort?e.short_name:e.long_name):k.val("");if(a.gPostalCodeField&&
""!=a.gPostalCodeField&&(k=c('input[name="'+a.gPostalCodeField+'"]')))(e=g(h.obj,"postal_code"))&&e.short_name&&e.long_name?k.val(a.gPostalCodeFieldShort?e.short_name:e.long_name):k.val("");a.gLatField&&""!=a.gLatField&&(e=c('input[name="'+a.gLatField+'"]'))&&e.val(h.latLng.lat());a.gLngField&&""!=a.gLngField&&(e=c('input[name="'+a.gLngField+'"]'))&&e.val(h.latLng.lng());if(a.useMap&&""!=a.useMap&&!A&&(k=c("#"+a.useMap))&&k.gMap)if(e=k.data("gmap"))a.clearAllMarkers&&!s&&k.gMap("removeAllMarkers"),
s=e.gmap,s.panTo(h.obj.geometry.location),b=new google.maps.Marker({title:h.data,draggable:a.allowDragChange?!0:!1,animation:b?null:google.maps.Animation.DROP,map:s,position:h.obj.geometry.location}),a.allowDragChange&&google.maps.event.addListener(b,"dragend",function(a){(new google.maps.Geocoder).geocode({location:a.latLng},function(a,b){if(b==google.maps.GeocoderStatus.OK){var e=a[0].formatted_address,c=j(a);m.add(e,c);c=m.load(e);p.display(c,e);i(!0)}})}),e.markers.push(b);d();A||l.trigger("result",
[h.data,h.value,h]);return!0}function n(b,c){if(x==f)p.hide();else{var d=l.val();if(c||d!=u)u=d,d=s(d),d.length>=a.minChars?(l.addClass(a.loadingClass),a.matchCase||(d=d.toLowerCase()),o(d,q,t)):(t(),p.hide())}}function r(b){if(!b)return[""];var b=b.split(c.trim(a.multipleSeparator)),d=[];c.each(b,function(a,b){c.trim(b)&&(d[a]=c.trim(b))});return d}function s(b){if(!a.multiple)return b;b=r(b);return b[b.length-1]}function d(){p.hide();clearTimeout(v);t();a.mustMatch&&l.search(function(a){a||l.val("")})}
function q(z,g){if(g&&g.length&&w){t();p.display(g,z);var j=g[0].value;a.autoFill&&s(l.val()).toLowerCase()==z.toLowerCase()&&8!=x&&l.val().toLowerCase()==j.substring(0,l.val().length).toLowerCase()&&(l.val(l.val()+j.substring(s(u).length)),c.Autocompleter.Selection(b,u.length,u.length+j.length));p.show()}else d()}function o(b,l,g){a.matchCase||(b=b.toLowerCase());var h=m.load(b);if(h&&h.length)l(b,h);else if("string"==typeof a.url&&0<a.url.length&&(!a.staticData||!h)){if(a.matchContains)a.extraParams=
c.extend({mc:"true"},a.extraParams);if(a.searchAll)a.extraParams=c.extend({sa:"true"},a.extraParams);a.isGoogleAjax?(new google.maps.Geocoder).geocode(a.gRegion?{address:b+(!a.gLimitType&&a.limitName?","+a.limitName:""),region:a.limitCode}:{address:b},function(a,c){if(c==google.maps.GeocoderStatus.OK){var h=j(a);m.add(b,h);h=m.load(b);l(b,h)}else d()}):c.ajax({url:a.url,data:!a.staticData?c.extend({q:s(b),limit:a.max},a.extraParams):"",success:function(e){var d;if(!(d=a.parse&&a.parse(e))){d=[];for(var e=
e.split("\n"),h=0;h<e.length;h++){var g=c.trim(e[h]);g&&(g=g.split("|"),d[d.length]={data:g,value:g[0],idVal:a.idField&&a.hiddenIdField?g[1]:"",result:a.formatResult&&a.formatResult(g)||g[0]})}}m.add(b,d);d=m.load(b);l(b,d)},error:function(b){var a=c('<div id="error"/>').css({position:"absolute",width:"400px",height:"300px",left:"50%",top:"50%",border:"3px solid #f00",marginLeft:"-250px",marginTop:"-150px"}).appendTo("body");c("<div/>").css({width:"400px",height:"25px",backgroundColor:"#f00",textAlign:"center",
fontWeight:"bold",color:"#fff"}).text("Ajax AutoComplete Server Error").appendTo(a);c("<div/>").css({width:"400px",height:"275px",backgroundColor:"#fff",color:"#000",overflow:"auto"}).html(b.responseText).appendTo(a);c("<div/>").css({position:"absolute",width:"15px",height:"25px",top:"0px",right:"0px",fontWeight:"bold",color:"#fff",cursor:"pointer"}).text("X").click(function(){a.remove()}).appendTo(a)}})}else g(b)}function j(b){for(var c=[],d=0;d<b.length;d++){var h=b[d];if(h&&("all"==a.gLimitType||
""==a.limitCode||a.limitCode==g(h,"country").short_name))c[c.length]={data:h.formatted_address,value:h.formatted_address,latLng:h.geometry.location,result:h.formatted_address,obj:h}}return c}function g(b,a){if(b&&b.address_components)for(var d=0;d<b.address_components.length;d++){var h=b.address_components[d];if(-1!=c.inArray(a,h.types))return h}return null}function t(){l.removeClass(a.loadingClass)}f=46;var l=c(b).attr("autocomplete","off").addClass(a.inputClass),v,u="",m=c.Autocompleter.Cache(a),
w=0,x,p=c.Autocompleter.Select(a,b,i),y;c.browser.opera&&c(b.form).bind("submit.autocomplete",function(){if(y)return y=!1});l.bind((c.browser.opera?"keypress":"keydown")+".autocomplete",function(b){w=1;x=b.keyCode;switch(b.keyCode){case 38:p.visible()?(b.preventDefault(),p.prev()):n(0,!0);break;case 40:p.visible()?(b.preventDefault(),p.next()):n(0,!0);break;case a.multiple&&","==c.trim(a.multipleSeparator)&&188:case 9:case 13:if(i())return b.preventDefault(),y=!0,!1;break;case 27:p.hide();break;default:clearTimeout(v),
v=setTimeout(n,a.delay)}}).keypress(function(){}).focus(function(){w++}).blur(function(){w=0;clearTimeout(v);v=setTimeout(d,200)}).click(function(){1<w++&&!p.visible()&&n(0,!0)}).bind("search",function(){function b(a,c){var d;if(c&&c.length)for(var e=0;e<c.length;e++)if(c[e].result.toLowerCase()==a.toLowerCase()){d=c[e];break}l.trigger("result",d&&[d.data,d.value,d])}c.each(r(l.val()),function(a,c){o(c,b,b)})}).bind("select",function(b,a,c,d,e){p.display([d],a);i(!0,!0,e)});d()};c.Autocompleter.defaults=
{highlightClass:"ac_highlight",inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:2,delay:500,matchCase:!1,matchSubset:!0,matchContains:!1,gRegion:"",gLimitType:"",gStreetField:"",gStreetNumberField:"",gStreetFieldShort:!1,gPostalCodeField:"",gPostalCodeFieldShort:!1,gCityField:"",gCityFieldShort:!1,gStateField:"",gStateFieldShort:!1,gCountryField:"",gCountryFieldShort:!1,gLatField:"",gLngField:"",useMap:"",clearAllMarkers:!0,allowDragChange:!0,idField:"",hiddenIdField:"",
cacheLength:10,mustMatch:!1,extraParams:{},selectFirst:!0,max:10,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",opacity:0.8,showFullItem:!0,searchAll:!1,itemSeparator:"<br/>"};c.Autocompleter.Cache=function(b){function a(a,c){var q=!1,o=!1;if("string"==typeof a){b.matchCase||(a=a.toLowerCase());var j=a.indexOf(c);return-1==j?!1:0==j||b.matchContains}for(var g=b.searchAll?a.length:1,j=0;j<g;j++){var f=a[j];b.matchCase||(f=f.toLowerCase());f=f.indexOf(c);-1<f&&(q=!0);0==f&&(o=!0)}return!q?!1:
o||b.matchContains}function f(a,c){r>b.cacheLength&&this.flush();n[a]||r++;n[a]=c}function i(){if(!b.data)return!1;var a={},d=0;if(!b.url)b.cacheLength=1;a[""]=[];c.each(b.data,function(c,f){value=b.formatItem?b.formatItem(f,f,c+1,b.data.length):f;var j=value.charAt(0).toLowerCase();a[j]||(a[j]=[]);var g={value:value,data:f,result:b.formatResult&&b.formatResult(f)||value};a[j].push(g);d++<b.max&&a[""].push(g)});c.each(a,function(a,c){b.cacheLength++;f(a,c)})}var n={},r=0;setTimeout(i,25);return{flush:function(){n=
{};r=0},add:f,populate:i,load:function(f){if(!b.cacheLength||!r)return null;if(!b.url&&b.matchContains){var d=[],i;for(i in n)if(0<i.length){var o=n[i];c.each(o,function(b,c){a(c.data,f)&&d.push(c)})}return d}if(b.matchSubset)for(i=f.length;i>=b.minChars;i--){if(o=n[f.substr(0,i)])return d=[],c.each(o,function(b,c){a(c.data,f)&&(d[d.length]=c)}),d}else if(n[f])return n[f];return null}}};c.Autocompleter.Select=function(b,a,f){var i;function n(a){var b=a.target;if("UL"==b.tagName)b=a.relatedTarget;
for(;"LI"!=b.tagName;)b=b.parentNode;return b}function r(a){j+=a;0>j?j=o.size()-1:j>=o.size()&&(j=0);o.removeClass().eq(j).addClass(i)}function s(){function a(c){var d=t.replace(/(\.|\?|\||\(|\)|\[|\]|\{|\}|\$|\^|\*|\+|\\)/g,"\\$1");return b.highlightClass?c.replace(RegExp((b.matchContains?"":"^")+"("+d+")","gi"),"<span class='"+b.highlightClass+"'>$1</span>"):c.replace(RegExp((b.matchContains?"":"^")+"("+d+")","gi"),"<strong>$1</strong>")}function d(a,c){if("string"!=typeof c&&1<c.length)for(var a=
"<span class='ac_title'>"+a+"</span>",f=b.idField&&b.hiddenIdField?2:1;f<c.length;f++)a+=b.itemSeparator+c[f];return a}for(var f=0<b.max&&b.max<g.length?b.max:g.length,m=0;m<f;m++)g[m]&&c("<li/>").html(b.formatItem?b.searchAll?a(b.formatItem(g[m].value,g[m].data,m+1,f)):b.formatItem(a(g[m].value),g[m].data,m+1,f):b.showFullItem?d(a(g[m].value),g[m].data):a(g[m].value)).appendTo(q);o=q.find("li");b.selectFirst&&(o.eq(0).addClass(i),j=0)}i="ac_over";var d=c("<div/>").hide().addClass(b.resultsClass).css("position",
"absolute").appendTo("body");!c.browser.msie&&!/6.0/.test(navigator.userAgent)&&d.css("opacity",b.opacity);var q=c("<ul/>").appendTo(d).mouseover(function(a){j=c("li",q).removeClass().index(n(a));c(n(a)).addClass(i)}).mouseout(function(a){c(n(a)).removeClass()}).click(function(b){c(n(b)).addClass(i);f();a.focus();return!1}),o,j=-1,g,t="";0<b.width&&d.css("width",b.width);return{display:function(a,b){g=a;t=b;q.empty();s();c.fn.bgiframe&&q.bgiframe()},next:function(){r(1)},prev:function(){r(-1)},hide:function(){if(b.onHide)b.onHide(d);
else if(b.fxHide){if(!b.fxHide.duration)b.fxHide.duration="normal";switch(b.fxHide.type.toLowerCase()){case "slide":d.slideUp(b.fxHide.duration);break;case "fade":d.fadeOut(b.fxHide.duration);break;default:d.hide()}}else d.hide();j=-1},visible:function(){return d&&d.is(":visible")},current:function(){return this.visible()&&(o.filter("."+i)[0]||b.selectFirst&&o[0])},show:function(){var f=c(a).offset();d.css({width:0<b.width?b.width:c(a).width(),top:f.top+a.offsetHeight,left:f.left});if(b.onShow)b.onShow(d);
else if(b.fxShow){if(!b.fxShow.duration)b.fxShow.duration="normal";switch(b.fxShow.type.toLowerCase()){case "slide":d.slideDown(b.fxShow.duration);break;case "fade":d.fadeIn(b.fxShow.duration);break;default:d.show()}}else d.show()},selected:function(){return g&&g[j]},emptyList:function(){q&&q.empty()},unbind:function(){d&&d.remove()}}};c.Autocompleter.Selection=function(b,a,c){if(b.createTextRange){var i=b.createTextRange();i.collapse(!0);i.moveStart("character",a);i.moveEnd("character",c);i.select()}else if(b.setSelectionRange)b.setSelectionRange(a,
c);else if(b.selectionStart)b.selectionStart=a,b.selectionEnd=c;b.focus()}})(jQuery);
